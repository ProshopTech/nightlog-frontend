<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>NIGHTLOG ‚Äî Community Event Hub</title>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;600;700;900&family=Rajdhani:wght@300;400;500;600;700&family=Share+Tech+Mono&display=swap" rel="stylesheet" />
<style>
  :root {
    --bg-void: #050508;
    --bg-deep: #0a0b12;
    --bg-card: #0f1020;
    --bg-card2: #141628;
    --border: rgba(99, 102, 241, 0.2);
    --border-bright: rgba(99, 102, 241, 0.6);
    --indigo: #6366f1;
    --indigo-bright: #818cf8;
    --indigo-glow: rgba(99, 102, 241, 0.4);
    --violet: #7c3aed;
    --cyan: #22d3ee;
    --cyan-glow: rgba(34, 211, 238, 0.3);
    --pink: #ec4899;
    --green: #10b981;
    --red: #ef4444;
    --yellow: #f59e0b;
    --text-primary: #e2e8f0;
    --text-secondary: #94a3b8;
    --text-muted: #475569;
    --font-display: 'Orbitron', monospace;
    --font-body: 'Rajdhani', sans-serif;
    --font-mono: 'Share Tech Mono', monospace;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    background: var(--bg-void);
    color: var(--text-primary);
    font-family: var(--font-body);
    min-height: 100vh;
    overflow-x: hidden;
  }

  /* ‚îÄ‚îÄ BACKGROUND ‚îÄ‚îÄ */
  .bg-grid {
    position: fixed; inset: 0; z-index: 0;
    background-image:
      linear-gradient(rgba(99,102,241,0.04) 1px, transparent 1px),
      linear-gradient(90deg, rgba(99,102,241,0.04) 1px, transparent 1px);
    background-size: 40px 40px;
    pointer-events: none;
  }
  .bg-glow {
    position: fixed; inset: 0; z-index: 0; pointer-events: none;
    background:
      radial-gradient(ellipse 60% 40% at 15% 50%, rgba(99,102,241,0.08) 0%, transparent 70%),
      radial-gradient(ellipse 40% 60% at 85% 20%, rgba(124,58,237,0.06) 0%, transparent 70%),
      radial-gradient(ellipse 50% 30% at 60% 90%, rgba(34,211,238,0.04) 0%, transparent 70%);
  }
  .noise {
    position: fixed; inset: 0; z-index: 0; pointer-events: none; opacity: 0.025;
    background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)'/%3E%3C/svg%3E");
  }

  /* ‚îÄ‚îÄ LAYOUT ‚îÄ‚îÄ */
  .app { position: relative; z-index: 1; display: flex; flex-direction: column; min-height: 100vh; }

  /* ‚îÄ‚îÄ HEADER ‚îÄ‚îÄ */
  header {
    display: flex; align-items: center; justify-content: space-between;
    padding: 0 32px; height: 64px;
    border-bottom: 1px solid var(--border);
    background: rgba(10, 11, 18, 0.9);
    backdrop-filter: blur(20px);
    position: sticky; top: 0; z-index: 100;
  }
  .logo {
    font-family: var(--font-display); font-size: 22px; font-weight: 900;
    letter-spacing: 4px; color: var(--indigo-bright);
    text-shadow: 0 0 20px var(--indigo-glow), 0 0 40px rgba(99,102,241,0.2);
    display: flex; align-items: center; gap: 10px;
  }
  .logo-dot { width: 8px; height: 8px; background: var(--cyan); border-radius: 50%; box-shadow: 0 0 12px var(--cyan-glow); animation: pulse 2s infinite; }
  @keyframes pulse { 0%,100%{opacity:1;transform:scale(1)} 50%{opacity:0.5;transform:scale(0.8)} }

  nav { display: flex; gap: 4px; }
  .nav-btn {
    font-family: var(--font-body); font-size: 13px; font-weight: 600;
    letter-spacing: 1.5px; text-transform: uppercase;
    padding: 8px 18px; border-radius: 4px; border: none; cursor: pointer;
    color: var(--text-secondary); background: transparent;
    transition: all 0.2s; position: relative; overflow: hidden;
  }
  .nav-btn:hover { color: var(--text-primary); background: rgba(99,102,241,0.1); }
  .nav-btn.active {
    color: var(--indigo-bright); background: rgba(99,102,241,0.15);
    border: 1px solid rgba(99,102,241,0.3);
  }
  .nav-btn.active::after {
    content: ''; position: absolute; bottom: 0; left: 50%; transform: translateX(-50%);
    width: 60%; height: 2px; background: var(--indigo); border-radius: 2px;
    box-shadow: 0 0 8px var(--indigo-glow);
  }

  .header-right { display: flex; align-items: center; gap: 12px; }
  .discord-status {
    display: flex; align-items: center; gap: 6px;
    padding: 6px 12px; border-radius: 4px;
    background: rgba(88,101,242,0.15); border: 1px solid rgba(88,101,242,0.3);
    font-family: var(--font-mono); font-size: 11px; color: #7289da;
    cursor: pointer; transition: all 0.2s;
  }
  .discord-status:hover { background: rgba(88,101,242,0.25); }
  .discord-dot { width: 6px; height: 6px; background: var(--green); border-radius: 50%; box-shadow: 0 0 8px rgba(16,185,129,0.8); animation: pulse 2s infinite; }

  .avatar-btn {
    width: 36px; height: 36px; border-radius: 6px; border: 2px solid var(--border);
    background: linear-gradient(135deg, var(--indigo), var(--violet));
    cursor: pointer; display: flex; align-items: center; justify-content: center;
    font-family: var(--font-display); font-size: 12px; font-weight: 700;
    transition: all 0.2s; color: white;
  }
  .avatar-btn:hover { border-color: var(--indigo); box-shadow: 0 0 16px var(--indigo-glow); }

  /* ‚îÄ‚îÄ MAIN ‚îÄ‚îÄ */
  main { flex: 1; padding: 32px; max-width: 1400px; margin: 0 auto; width: 100%; }

  /* ‚îÄ‚îÄ SECTION HEADER ‚îÄ‚îÄ */
  .section-header {
    display: flex; align-items: flex-end; justify-content: space-between;
    margin-bottom: 28px;
  }
  .section-title { font-family: var(--font-display); font-size: 28px; font-weight: 700; letter-spacing: 2px; }
  .section-title span { color: var(--indigo-bright); }
  .section-sub { font-size: 13px; color: var(--text-muted); letter-spacing: 1px; margin-top: 4px; }

  /* ‚îÄ‚îÄ BUTTONS ‚îÄ‚îÄ */
  .btn {
    font-family: var(--font-body); font-weight: 600; letter-spacing: 1px;
    text-transform: uppercase; font-size: 13px;
    padding: 10px 24px; border-radius: 4px; border: none; cursor: pointer;
    transition: all 0.2s; display: inline-flex; align-items: center; gap: 8px;
  }
  .btn-primary {
    background: linear-gradient(135deg, var(--indigo), var(--violet));
    color: white; box-shadow: 0 0 20px rgba(99,102,241,0.3);
  }
  .btn-primary:hover { box-shadow: 0 0 32px rgba(99,102,241,0.5); transform: translateY(-1px); }
  .btn-ghost {
    background: transparent; color: var(--text-secondary);
    border: 1px solid var(--border);
  }
  .btn-ghost:hover { border-color: var(--indigo); color: var(--indigo-bright); background: rgba(99,102,241,0.08); }
  .btn-danger { background: rgba(239,68,68,0.15); color: var(--red); border: 1px solid rgba(239,68,68,0.3); }
  .btn-danger:hover { background: rgba(239,68,68,0.25); }
  .btn-sm { padding: 6px 14px; font-size: 11px; }
  .btn-cyan {
    background: rgba(34,211,238,0.1); color: var(--cyan);
    border: 1px solid rgba(34,211,238,0.3);
  }
  .btn-cyan:hover { background: rgba(34,211,238,0.2); box-shadow: 0 0 20px var(--cyan-glow); }

  /* ‚îÄ‚îÄ CARDS ‚îÄ‚îÄ */
  .card {
    background: var(--bg-card); border: 1px solid var(--border);
    border-radius: 8px; padding: 24px;
    transition: all 0.3s; position: relative; overflow: hidden;
  }
  .card::before {
    content: ''; position: absolute; top: 0; left: 0; right: 0; height: 2px;
    background: linear-gradient(90deg, transparent, var(--indigo), transparent);
    opacity: 0; transition: opacity 0.3s;
  }
  .card:hover::before { opacity: 1; }
  .card:hover { border-color: var(--border-bright); box-shadow: 0 8px 32px rgba(99,102,241,0.1); transform: translateY(-2px); }

  /* ‚îÄ‚îÄ STATS BAR ‚îÄ‚îÄ */
  .stats-bar {
    display: grid; grid-template-columns: repeat(4, 1fr); gap: 16px; margin-bottom: 32px;
  }
  .stat-card {
    background: var(--bg-card); border: 1px solid var(--border);
    border-radius: 8px; padding: 20px 24px;
    display: flex; align-items: center; gap: 16px;
    transition: all 0.2s;
  }
  .stat-card:hover { border-color: var(--border-bright); }
  .stat-icon {
    width: 44px; height: 44px; border-radius: 8px;
    display: flex; align-items: center; justify-content: center;
    font-size: 20px;
  }
  .stat-icon.purple { background: rgba(99,102,241,0.15); border: 1px solid rgba(99,102,241,0.25); }
  .stat-icon.cyan { background: rgba(34,211,238,0.1); border: 1px solid rgba(34,211,238,0.2); }
  .stat-icon.green { background: rgba(16,185,129,0.1); border: 1px solid rgba(16,185,129,0.2); }
  .stat-icon.pink { background: rgba(236,72,153,0.1); border: 1px solid rgba(236,72,153,0.2); }
  .stat-value { font-family: var(--font-display); font-size: 26px; font-weight: 700; }
  .stat-label { font-size: 12px; color: var(--text-muted); letter-spacing: 1px; text-transform: uppercase; margin-top: 2px; }

  /* ‚îÄ‚îÄ CALENDAR ‚îÄ‚îÄ */
  .calendar-layout { display: grid; grid-template-columns: 1fr 320px; gap: 24px; }
  .calendar-grid {
    background: var(--bg-card); border: 1px solid var(--border);
    border-radius: 8px; overflow: hidden;
  }
  .cal-header {
    display: flex; align-items: center; justify-content: space-between;
    padding: 20px 24px; border-bottom: 1px solid var(--border);
  }
  .cal-month { font-family: var(--font-display); font-size: 18px; font-weight: 700; letter-spacing: 2px; }
  .cal-nav { display: flex; gap: 8px; }
  .cal-nav-btn {
    width: 32px; height: 32px; border-radius: 4px; border: 1px solid var(--border);
    background: transparent; color: var(--text-secondary); cursor: pointer; font-size: 14px;
    display: flex; align-items: center; justify-content: center; transition: all 0.2s;
  }
  .cal-nav-btn:hover { border-color: var(--indigo); color: var(--indigo-bright); }

  .cal-days-header {
    display: grid; grid-template-columns: repeat(7, 1fr);
    border-bottom: 1px solid var(--border);
  }
  .cal-day-label {
    text-align: center; padding: 12px 0;
    font-size: 11px; font-weight: 600; letter-spacing: 2px;
    text-transform: uppercase; color: var(--text-muted);
    font-family: var(--font-mono);
  }
  .cal-cells { display: grid; grid-template-columns: repeat(7, 1fr); }
  .cal-cell {
    min-height: 90px; padding: 8px; border-right: 1px solid var(--border);
    border-bottom: 1px solid var(--border); cursor: pointer;
    transition: background 0.2s; position: relative;
  }
  .cal-cell:nth-child(7n) { border-right: none; }
  .cal-cell:hover { background: rgba(99,102,241,0.05); }
  .cal-cell.other-month { opacity: 0.3; }
  .cal-cell.today { background: rgba(99,102,241,0.08); }
  .cal-cell.today .cal-date { color: var(--indigo-bright); }
  .cal-cell.selected { background: rgba(99,102,241,0.12); }
  .cal-date {
    font-family: var(--font-mono); font-size: 13px; color: var(--text-secondary);
    width: 26px; height: 26px; display: flex; align-items: center; justify-content: center;
    border-radius: 50%;
  }
  .cal-cell.today .cal-date {
    background: var(--indigo); color: white;
    box-shadow: 0 0 12px var(--indigo-glow);
  }
  .event-pill {
    font-size: 10px; font-weight: 600; letter-spacing: 0.5px;
    padding: 2px 6px; border-radius: 3px; margin-top: 3px;
    white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
    cursor: pointer; transition: all 0.2s;
  }
  .event-pill.gaming { background: rgba(99,102,241,0.2); color: var(--indigo-bright); border-left: 2px solid var(--indigo); }
  .event-pill.tournament { background: rgba(236,72,153,0.15); color: var(--pink); border-left: 2px solid var(--pink); }
  .event-pill.stream { background: rgba(34,211,238,0.1); color: var(--cyan); border-left: 2px solid var(--cyan); }
  .event-pill.social { background: rgba(16,185,129,0.1); color: var(--green); border-left: 2px solid var(--green); }

  /* ‚îÄ‚îÄ SIDEBAR ‚îÄ‚îÄ */
  .sidebar { display: flex; flex-direction: column; gap: 20px; }
  .sidebar-card { background: var(--bg-card); border: 1px solid var(--border); border-radius: 8px; padding: 20px; }
  .sidebar-title { font-family: var(--font-display); font-size: 12px; letter-spacing: 2px; text-transform: uppercase; color: var(--text-muted); margin-bottom: 16px; }

  .upcoming-event {
    padding: 12px 0; border-bottom: 1px solid rgba(99,102,241,0.08);
    cursor: pointer; transition: all 0.2s;
  }
  .upcoming-event:last-child { border-bottom: none; }
  .upcoming-event:hover { padding-left: 6px; }
  .ue-date { font-family: var(--font-mono); font-size: 10px; color: var(--text-muted); letter-spacing: 1px; }
  .ue-title { font-size: 14px; font-weight: 600; margin: 3px 0; }
  .ue-meta { display: flex; align-items: center; gap: 8px; }
  .ue-tag {
    font-size: 10px; padding: 2px 8px; border-radius: 20px; font-weight: 600; letter-spacing: 0.5px;
  }
  .ue-rsvp { font-size: 11px; color: var(--text-muted); }

  /* ‚îÄ‚îÄ EVENT CARDS (list view) ‚îÄ‚îÄ */
  .events-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(340px, 1fr)); gap: 20px; }
  .event-card {
    background: var(--bg-card); border: 1px solid var(--border);
    border-radius: 8px; overflow: hidden;
    transition: all 0.3s; cursor: pointer;
  }
  .event-card:hover { border-color: var(--border-bright); transform: translateY(-3px); box-shadow: 0 12px 40px rgba(0,0,0,0.4), 0 0 0 1px rgba(99,102,241,0.15); }
  .event-card-banner {
    height: 8px;
    background: linear-gradient(90deg, var(--indigo), var(--violet));
  }
  .event-card-banner.tournament { background: linear-gradient(90deg, var(--pink), var(--violet)); }
  .event-card-banner.stream { background: linear-gradient(90deg, var(--cyan), var(--indigo)); }
  .event-card-banner.social { background: linear-gradient(90deg, var(--green), var(--cyan)); }
  .event-card-body { padding: 20px; }
  .event-type-badge {
    font-size: 10px; font-weight: 700; letter-spacing: 2px; text-transform: uppercase;
    padding: 3px 10px; border-radius: 20px; display: inline-flex; align-items: center; gap: 4px;
    margin-bottom: 12px;
  }
  .event-card-title { font-family: var(--font-display); font-size: 16px; font-weight: 700; letter-spacing: 1px; margin-bottom: 8px; }
  .event-card-desc { font-size: 13px; color: var(--text-secondary); line-height: 1.6; margin-bottom: 16px; }
  .event-meta-row { display: flex; gap: 16px; margin-bottom: 16px; }
  .event-meta-item { display: flex; align-items: center; gap: 6px; font-size: 12px; color: var(--text-muted); font-family: var(--font-mono); }
  .event-actions { display: flex; gap: 8px; align-items: center; }
  .rsvp-count { margin-left: auto; display: flex; align-items: center; gap: 6px; font-size: 12px; color: var(--text-muted); }
  .rsvp-avatars { display: flex; }
  .rsvp-av {
    width: 24px; height: 24px; border-radius: 50%; border: 2px solid var(--bg-card);
    background: linear-gradient(135deg, var(--indigo), var(--violet));
    display: flex; align-items: center; justify-content: center;
    font-size: 9px; font-weight: 700; margin-left: -8px; color: white;
  }
  .rsvp-av:first-child { margin-left: 0; }

  /* ‚îÄ‚îÄ MODAL ‚îÄ‚îÄ */
  .modal-overlay {
    position: fixed; inset: 0; background: rgba(5,5,8,0.85); backdrop-filter: blur(8px);
    z-index: 200; display: flex; align-items: center; justify-content: center;
    animation: fadeIn 0.2s ease;
  }
  @keyframes fadeIn { from { opacity:0 } to { opacity:1 } }
  .modal {
    background: var(--bg-card2); border: 1px solid var(--border);
    border-radius: 12px; width: 540px; max-width: 95vw; max-height: 90vh;
    overflow-y: auto; box-shadow: 0 24px 80px rgba(0,0,0,0.6), 0 0 0 1px rgba(99,102,241,0.1);
    animation: slideUp 0.25s ease;
  }
  @keyframes slideUp { from { opacity:0; transform:translateY(20px) } to { opacity:1; transform:translateY(0) } }
  .modal-header {
    display: flex; align-items: center; justify-content: space-between;
    padding: 24px 28px 0; margin-bottom: 24px;
  }
  .modal-title { font-family: var(--font-display); font-size: 18px; font-weight: 700; letter-spacing: 1.5px; }
  .modal-close {
    width: 32px; height: 32px; border-radius: 4px; border: 1px solid var(--border);
    background: transparent; color: var(--text-muted); cursor: pointer; font-size: 18px;
    display: flex; align-items: center; justify-content: center; transition: all 0.2s;
  }
  .modal-close:hover { border-color: var(--red); color: var(--red); }
  .modal-body { padding: 0 28px 28px; }

  /* ‚îÄ‚îÄ FORM ‚îÄ‚îÄ */
  .form-group { margin-bottom: 18px; }
  .form-label { display: block; font-size: 11px; font-weight: 600; letter-spacing: 1.5px; text-transform: uppercase; color: var(--text-muted); margin-bottom: 8px; }
  .form-input {
    width: 100%; background: rgba(10,11,18,0.8); border: 1px solid var(--border);
    border-radius: 6px; padding: 10px 14px;
    font-family: var(--font-body); font-size: 14px; color: var(--text-primary);
    transition: all 0.2s; outline: none;
  }
  .form-input:focus { border-color: var(--indigo); box-shadow: 0 0 0 3px rgba(99,102,241,0.1); }
  .form-input::placeholder { color: var(--text-muted); }
  .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 14px; }
  .form-select { appearance: none; cursor: pointer; }
  textarea.form-input { resize: vertical; min-height: 80px; }
  .type-selector { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; }
  .type-option {
    padding: 10px 6px; border-radius: 6px; border: 1px solid var(--border);
    text-align: center; cursor: pointer; transition: all 0.2s;
    font-size: 11px; font-weight: 600; letter-spacing: 0.5px;
  }
  .type-option:hover { border-color: var(--indigo); }
  .type-option.selected { background: rgba(99,102,241,0.15); border-color: var(--indigo); color: var(--indigo-bright); }
  .type-emoji { font-size: 20px; display: block; margin-bottom: 4px; }

  /* ‚îÄ‚îÄ PROFILES ‚îÄ‚îÄ */
  .profiles-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 16px; }
  .profile-card {
    background: var(--bg-card); border: 1px solid var(--border);
    border-radius: 8px; padding: 24px; text-align: center;
    transition: all 0.3s; cursor: pointer;
  }
  .profile-card:hover { border-color: var(--border-bright); transform: translateY(-3px); box-shadow: 0 12px 40px rgba(99,102,241,0.1); }
  .profile-av {
    width: 64px; height: 64px; border-radius: 12px;
    margin: 0 auto 12px; font-size: 24px; font-weight: 700;
    display: flex; align-items: center; justify-content: center;
    font-family: var(--font-display); color: white;
    position: relative;
  }
  .profile-av::after {
    content: ''; position: absolute; inset: -3px; border-radius: 14px;
    background: inherit; filter: blur(12px); opacity: 0.4; z-index: -1;
  }
  .profile-name { font-family: var(--font-display); font-size: 14px; font-weight: 700; letter-spacing: 1px; margin-bottom: 4px; }
  .profile-role { font-size: 11px; color: var(--text-muted); letter-spacing: 1px; text-transform: uppercase; margin-bottom: 12px; }
  .profile-stats { display: flex; justify-content: center; gap: 20px; }
  .ps { text-align: center; }
  .ps-val { font-family: var(--font-display); font-size: 16px; font-weight: 700; color: var(--indigo-bright); }
  .ps-label { font-size: 10px; color: var(--text-muted); letter-spacing: 1px; }
  .online-badge {
    display: inline-flex; align-items: center; gap: 4px;
    font-size: 10px; color: var(--green); margin-bottom: 10px;
  }
  .online-dot { width: 6px; height: 6px; background: var(--green); border-radius: 50%; box-shadow: 0 0 6px rgba(16,185,129,0.8); }

  /* ‚îÄ‚îÄ DISCORD PANEL ‚îÄ‚îÄ */
  .discord-panel { max-width: 800px; }
  .discord-card { background: var(--bg-card); border: 1px solid var(--border); border-radius: 8px; padding: 28px; margin-bottom: 20px; }
  .sync-status {
    display: flex; align-items: center; gap: 16px; padding: 16px 20px;
    background: rgba(16,185,129,0.05); border: 1px solid rgba(16,185,129,0.2);
    border-radius: 6px; margin-bottom: 24px;
  }
  .sync-icon { font-size: 24px; }
  .sync-info { flex: 1; }
  .sync-title { font-size: 14px; font-weight: 600; color: var(--green); }
  .sync-sub { font-size: 12px; color: var(--text-muted); margin-top: 2px; font-family: var(--font-mono); }
  .command-list { display: flex; flex-direction: column; gap: 8px; }
  .command-item {
    display: flex; align-items: center; gap: 16px; padding: 12px 16px;
    background: rgba(10,11,18,0.6); border: 1px solid var(--border); border-radius: 6px;
  }
  .command-name { font-family: var(--font-mono); font-size: 13px; color: var(--cyan); min-width: 160px; }
  .command-desc { font-size: 13px; color: var(--text-secondary); }
  .webhook-config { display: flex; gap: 10px; }
  .webhook-input { flex: 1; }

  /* ‚îÄ‚îÄ TOAST ‚îÄ‚îÄ */
  .toast-container { position: fixed; bottom: 24px; right: 24px; z-index: 500; display: flex; flex-direction: column; gap: 8px; }
  .toast {
    background: var(--bg-card2); border: 1px solid var(--border);
    border-radius: 6px; padding: 14px 18px;
    display: flex; align-items: center; gap: 12px;
    font-size: 14px; min-width: 280px;
    box-shadow: 0 8px 32px rgba(0,0,0,0.4);
    animation: toastIn 0.3s ease;
  }
  @keyframes toastIn { from{opacity:0;transform:translateX(40px)} to{opacity:1;transform:translateX(0)} }
  .toast.success { border-color: rgba(16,185,129,0.4); }
  .toast.success .toast-icon { color: var(--green); }
  .toast.info { border-color: rgba(99,102,241,0.4); }
  .toast.info .toast-icon { color: var(--indigo-bright); }
  .toast-icon { font-size: 18px; }

  /* ‚îÄ‚îÄ SCROLLBAR ‚îÄ‚îÄ */
  ::-webkit-scrollbar { width: 4px; }
  ::-webkit-scrollbar-track { background: var(--bg-deep); }
  ::-webkit-scrollbar-thumb { background: rgba(99,102,241,0.3); border-radius: 2px; }
  ::-webkit-scrollbar-thumb:hover { background: rgba(99,102,241,0.5); }

  /* ‚îÄ‚îÄ TAG COLORS ‚îÄ‚îÄ */
  .tag-gaming { background: rgba(99,102,241,0.15); color: var(--indigo-bright); }
  .tag-tournament { background: rgba(236,72,153,0.15); color: var(--pink); }
  .tag-stream { background: rgba(34,211,238,0.1); color: var(--cyan); }
  .tag-social { background: rgba(16,185,129,0.1); color: var(--green); }

  /* ‚îÄ‚îÄ EMPTY STATE ‚îÄ‚îÄ */
  .empty-state { text-align: center; padding: 60px 20px; }
  .empty-icon { font-size: 48px; margin-bottom: 16px; opacity: 0.5; }
  .empty-title { font-family: var(--font-display); font-size: 18px; color: var(--text-secondary); margin-bottom: 8px; }
  .empty-sub { font-size: 13px; color: var(--text-muted); }

  /* ‚îÄ‚îÄ ANIMATIONS ‚îÄ‚îÄ */
  @keyframes scanline {
    0% { transform: translateY(-100%); }
    100% { transform: translateY(100vh); }
  }
  .scanline {
    position: fixed; top: 0; left: 0; right: 0; height: 2px;
    background: linear-gradient(90deg, transparent, rgba(99,102,241,0.1), transparent);
    z-index: 0; pointer-events: none;
    animation: scanline 8s linear infinite;
  }

  .page { animation: pageIn 0.3s ease; }
  @keyframes pageIn { from{opacity:0;transform:translateY(8px)} to{opacity:1;transform:translateY(0)} }
</style>
</head>
<body>
<div class="bg-grid"></div>
<div class="bg-glow"></div>
<div class="noise"></div>
<div class="scanline"></div>

<div class="app">
  <header>
    <div class="logo">
      <div class="logo-dot"></div>
      NIGHTLOG
    </div>
    <nav>
      <button class="nav-btn active" onclick="showPage('calendar')">‚¨° Calendar</button>
      <button class="nav-btn" onclick="showPage('events')">‚ö° Events</button>
      <button class="nav-btn" onclick="showPage('profiles')">‚óà Members</button>
      <button class="nav-btn" onclick="showPage('discord')">‚¨° Discord</button>
    </nav>
    <div class="header-right">
      <div class="discord-status" onclick="showToast('Discord bot connected', 'success')">
        <div class="discord-dot"></div>
        BOT ONLINE
      </div>
      ${currentUser 
        ? `<div class="avatar-btn" onclick="logout()" title="Logout">${currentUser.username.slice(0,2).toUpperCase()}</div>`
        : `<button class="btn btn-sm btn-primary" onclick="loginWithDiscord()">Login with Discord</button>`
      }
    </div>
  </header>

  <main id="app-main"></main>
</div>

<div class="toast-container" id="toast-container"></div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê SCRIPTS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<script>
// ‚îÄ‚îÄ API CONFIG ‚îÄ‚îÄ
const API_URL = 'https://nightlog-backend-production.up.railway.app/api';

// ‚îÄ‚îÄ AUTH (Discord OAuth) ‚îÄ‚îÄ
let currentUser = null; // null = not logged in
let isLoading = true;

// Check for returning OAuth code in URL
const urlParams = new URLSearchParams(window.location.search);
const oauthCode = urlParams.get('code');
if (oauthCode) {
  handleOAuthCallback(oauthCode);
}

// Try to load user from localStorage
const savedUser = localStorage.getItem('nightlog_user');
if (savedUser) {
  currentUser = JSON.parse(savedUser);
}

async function loginWithDiscord() {
  try {
    const res = await fetch(`${API_URL}/auth/discord/url`);
    const data = await res.json();
    if (data.success) {
      window.location.href = data.url;
    }
  } catch (err) {
    console.error('Login failed:', err);
    showToast('Failed to start Discord login', 'info');
  }
}

async function handleOAuthCallback(code) {
  try {
    const res = await fetch(`${API_URL}/auth/discord/callback`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ code })
    });
    const data = await res.json();
    
    if (data.success) {
      currentUser = data.user;
      localStorage.setItem('nightlog_user', JSON.stringify(data.user));
      showToast(`Welcome back, ${data.user.username}!`, 'success');
      // Clean URL
      window.history.replaceState({}, document.title, window.location.pathname);
    } else {
      showToast(data.error || 'Login failed', 'info');
    }
  } catch (err) {
    console.error('OAuth callback failed:', err);
    showToast('Authentication failed', 'info');
  }
  render();
}

function logout() {
  currentUser = null;
  localStorage.removeItem('nightlog_user');
  showToast('Logged out', 'info');
  render();
}

// ‚îÄ‚îÄ DATA (loaded from API) ‚îÄ‚îÄ
let EVENTS = [];
let MEMBERS = [];
let isLoading = true;

// ‚îÄ‚îÄ TIME HELPERS ‚îÄ‚îÄ
function convertTo12Hour(time24) {
  if (!time24 || time24 === 'TBD') return 'TBD';
  const [hours, minutes] = time24.split(':');
  const hour = parseInt(hours);
  const ampm = hour >= 12 ? 'PM' : 'AM';
  const hour12 = hour % 12 || 12;
  return `${hour12}:${minutes} ${ampm}`;
}

function convertTo24Hour(time12) {
  const match = time12.match(/(\d+):(\d+)\s*(AM|PM)/i);
  if (!match) return time12;
  let [_, hour, min, period] = match;
  hour = parseInt(hour);
  if (period.toUpperCase() === 'PM' && hour !== 12) hour += 12;
  if (period.toUpperCase() === 'AM' && hour === 12) hour = 0;
  return `${String(hour).padStart(2,'0')}:${min}`;
}

function generateTimeOptions(selectedTime) {
  const times = [];
  for (let h = 1; h <= 12; h++) {
    ['00', '30'].forEach(m => {
      ['AM', 'PM'].forEach(period => {
        const time = `${h}:${m} ${period}`;
        const selected = time === selectedTime ? 'selected' : '';
        times.push(`<option value="${time}" ${selected}>${time}</option>`);
      });
    });
  }
  return times.join('');
}

// ‚îÄ‚îÄ API FUNCTIONS ‚îÄ‚îÄ
async function fetchEvents() {
  try {
    const res = await fetch(`${API_URL}/events`);
    const data = await res.json();
    if (data.success) {
      // Transform API format to match our frontend expectations
      EVENTS = data.events.map(e => ({
        id: e.id,
        title: e.title,
        type: e.type,
        date: e.event_date.split('T')[0], // Extract just YYYY-MM-DD
        time: convertTo12Hour(e.event_time) || 'TBD',
        duration: e.duration || 'TBD',
        desc: e.description || '',
        host: e.host_name || 'NIGHTLOG',
        rsvps: [], // Will be populated when we fetch attendees
        maxSlots: e.max_slots,
        discord: e.discord_sync
      }));
    }
  } catch (err) {
    console.error('Failed to fetch events:', err);
    showToast('Failed to load events from server', 'info');
  }
}

async function fetchMembers() {
  try {
    const res = await fetch(`${API_URL}/members`);
    const data = await res.json();
    if (data.success) {
      MEMBERS = data.members.map(m => ({
        id: m.id,
        name: m.username,
        tag: m.tag || '',
        role: m.role || 'Member',
        events: m.events_hosted || 0,
        rsvps: m.total_rsvps || 0,
        online: false, // We don't track online status yet
        color: `linear-gradient(135deg, #${Math.floor(Math.random()*16777215).toString(16)}, #${Math.floor(Math.random()*16777215).toString(16)})`,
        initials: m.username.slice(0,2).toUpperCase()
      }));
    }
  } catch (err) {
    console.error('Failed to fetch members:', err);
  }
}

async function createEvent(eventData) {
  try {
    const res = await fetch(`${API_URL}/events`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        title: eventData.title,
        description: eventData.desc,
        type: eventData.type,
        event_date: eventData.date,
        event_time: convertTo24Hour(eventData.time), // Convert to 24-hour for API
        duration: eventData.duration,
        discord_sync: true
      })
    });
    const data = await res.json();
    if (data.success) {
      await fetchEvents(); // Refresh the list
      showToast(`"${eventData.title}" created & synced to Discord!`, 'success');
      return true;
    }
  } catch (err) {
    console.error('Failed to create event:', err);
    showToast('Failed to create event', 'info');
  }
  return false;
}

// Load data on page load
async function loadData() {
  isLoading = true;
  await Promise.all([fetchEvents(), fetchMembers()]);
  isLoading = false;
  render();
}

// Start loading immediately
loadData();

const TYPE_META = {
  gaming:     { label:'Gaming',     emoji:'üéÆ', cls:'tag-gaming',     banner:'' },
  tournament: { label:'Tournament', emoji:'üèÜ', cls:'tag-tournament', banner:'tournament' },
  stream:     { label:'Stream',     emoji:'üì°', cls:'tag-stream',     banner:'stream' },
  social:     { label:'Social',     emoji:'üí¨', cls:'tag-social',     banner:'social' },
};

let currentPage = 'calendar';
let calYear = 2026, calMonth = 1; // 0-indexed: 1 = February
let selectedEvent = null;
let userRSVPs = new Set([1, 3]); // pre-RSVPd
let showModal = false;
let newEvent = { title:'', type:'gaming', date:'', time:'7:00 PM', duration:'2h', desc:'' };

// ‚îÄ‚îÄ ROUTER ‚îÄ‚îÄ
function showPage(p) {
  currentPage = p;
  document.querySelectorAll('.nav-btn').forEach((b, i) => {
    const pages = ['calendar','events','profiles','discord'];
    b.classList.toggle('active', pages[i] === p);
  });
  render();
}

function render() {
  const el = document.getElementById('app-main');
  const pages = { calendar: renderCalendar, events: renderEvents, profiles: renderProfiles, discord: renderDiscord };
  el.innerHTML = `<div class="page">${pages[currentPage]()}</div>`;
  attachHandlers();
}

// ‚îÄ‚îÄ CALENDAR PAGE ‚îÄ‚îÄ
function renderCalendar() {
  const monthNames = ['January','February','March','April','May','June','July','August','September','October','November','December'];
  const days = ['Sun','Mon','Tue','Wed','Thu','Fri','Sat'];

  const firstDay = new Date(calYear, calMonth, 1).getDay();
  const daysInMonth = new Date(calYear, calMonth + 1, 0).getDate();
  const daysInPrev = new Date(calYear, calMonth, 0).getDate();
  const today = new Date();

  let cells = '';
  // prev month tail
  for (let i = firstDay - 1; i >= 0; i--) {
    cells += `<div class="cal-cell other-month"><div class="cal-date">${daysInPrev - i}</div></div>`;
  }
  // current month
  for (let d = 1; d <= daysInMonth; d++) {
    const dateStr = `${calYear}-${String(calMonth+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
    const isToday = d === today.getDate() && calMonth === today.getMonth() && calYear === today.getFullYear();
    const eventsOnDay = EVENTS.filter(e => e.date === dateStr);
    const pills = eventsOnDay.map(e =>
      `<div class="event-pill ${e.type}" onclick="openEvent(${e.id}, event)">${TYPE_META[e.type].emoji} ${e.title}</div>`
    ).join('');
    cells += `<div class="cal-cell${isToday?' today':''}"><div class="cal-date">${d}</div>${pills}</div>`;
  }
  // next month fill
  const totalCells = Math.ceil((firstDay + daysInMonth) / 7) * 7;
  for (let d = 1; d <= totalCells - firstDay - daysInMonth; d++) {
    cells += `<div class="cal-cell other-month"><div class="cal-date">${d}</div></div>`;
  }

  const upcoming = EVENTS.filter(e => e.date >= `${calYear}-${String(calMonth+1).padStart(2,'0')}-01`).slice(0,5);

  return `
    <div class="section-header">
      <div>
        <div class="section-title">Event <span>Calendar</span></div>
        <div class="section-sub">Community schedule & upcoming sessions</div>
      </div>
      ${currentUser?.isAdmin ? '<button class="btn btn-primary" onclick="openCreateModal()">Ôºã Create Event</button>' : ''}
    </div>
    <div class="stats-bar">
      <div class="stat-card">
        <div class="stat-icon purple">üéÆ</div>
        <div><div class="stat-value">${EVENTS.length}</div><div class="stat-label">Total Events</div></div>
      </div>
      <div class="stat-card">
        <div class="stat-icon cyan">üë•</div>
        <div><div class="stat-value">${MEMBERS.length}</div><div class="stat-label">Members</div></div>
      </div>
      <div class="stat-card">
        <div class="stat-icon green">‚úì</div>
        <div><div class="stat-value">${userRSVPs.size}</div><div class="stat-label">Your RSVPs</div></div>
      </div>
      <div class="stat-card">
        <div class="stat-icon pink">üèÜ</div>
        <div><div class="stat-value">${EVENTS.filter(e => e.type === 'tournament').length}</div><div class="stat-label">Tournaments</div></div>
      </div>
    </div>
    <div class="calendar-layout">
      <div class="calendar-grid">
        <div class="cal-header">
          <div class="cal-month">${monthNames[calMonth].toUpperCase()} ${calYear}</div>
          <div class="cal-nav">
            <button class="cal-nav-btn" onclick="changeMonth(-1)">‚óÄ</button>
            <button class="cal-nav-btn" onclick="changeMonth(1)">‚ñ∂</button>
          </div>
        </div>
        <div class="cal-days-header">${days.map(d=>`<div class="cal-day-label">${d}</div>`).join('')}</div>
        <div class="cal-cells">${cells}</div>
      </div>
      <div class="sidebar">
        <div class="sidebar-card">
          <div class="sidebar-title">‚ö° Upcoming Events</div>
          ${upcoming.map(e => `
            <div class="upcoming-event" onclick="openEvent(${e.id}, event)">
              <div class="ue-date">${e.date} ¬∑ ${e.time}</div>
              <div class="ue-title">${e.title}</div>
              <div class="ue-meta">
                <span class="ue-tag ${TYPE_META[e.type].cls}">${TYPE_META[e.type].emoji} ${TYPE_META[e.type].label}</span>
                <span class="ue-rsvp">üë• ${e.rsvps.length} going</span>
              </div>
            </div>
          `).join('')}
        </div>
        <div class="sidebar-card">
          <div class="sidebar-title">üé® Legend</div>
          ${Object.entries(TYPE_META).map(([k,v])=>`
            <div style="display:flex;align-items:center;gap:10px;padding:6px 0;font-size:13px;">
              <span>${v.emoji}</span>
              <span class="ue-tag ${v.cls}">${v.label}</span>
            </div>
          `).join('')}
        </div>
      </div>
    </div>
    ${renderEventModal()}
    ${renderCreateModal()}
  `;
}

// ‚îÄ‚îÄ EVENTS PAGE ‚îÄ‚îÄ
function renderEvents() {
  return `
    <div class="section-header">
      <div>
        <div class="section-title">All <span>Events</span></div>
        <div class="section-sub">${EVENTS.length} events scheduled</div>
      </div>
      <button class="btn btn-primary" onclick="openCreateModal()">Ôºã Create Event</button>
    </div>
    <div class="events-grid">
      ${EVENTS.map(e => {
        const tm = TYPE_META[e.type];
        const isGoing = userRSVPs.has(e.id);
        return `
          <div class="event-card" onclick="openEvent(${e.id}, event)">
            <div class="event-card-banner ${tm.banner}"></div>
            <div class="event-card-body">
              <span class="event-type-badge ${tm.cls}">${tm.emoji} ${tm.label}</span>
              ${e.discord ? '<span style="font-size:10px;color:#7289da;float:right;margin-bottom:12px;font-family:var(--font-mono)">üîó DISCORD</span>' : ''}
              <div class="event-card-title">${e.title}</div>
              <div class="event-card-desc">${e.desc}</div>
              <div class="event-meta-row">
                <div class="event-meta-item">üìÖ ${e.date}</div>
                <div class="event-meta-item">‚è∞ ${e.time}</div>
                <div class="event-meta-item">‚è± ${e.duration}</div>
              </div>
              <div class="event-actions">
                <button class="btn btn-sm ${isGoing ? 'btn-danger' : 'btn-primary'}" onclick="toggleRSVP(${e.id}, event)">
                  ${isGoing ? '‚úì Going' : '+ RSVP'}
                </button>
                <div class="rsvp-count">
                  <div class="rsvp-avatars">${e.rsvps.slice(0,3).map(r=>`<div class="rsvp-av">${r.slice(0,2).toUpperCase()}</div>`).join('')}</div>
                  ${e.rsvps.length} going
                </div>
              </div>
            </div>
          </div>
        `;
      }).join('')}
    </div>
    ${renderEventModal()}
    ${renderCreateModal()}
  `;
}

// ‚îÄ‚îÄ PROFILES PAGE ‚îÄ‚îÄ
function renderProfiles() {
  return `
    <div class="section-header">
      <div>
        <div class="section-title">Community <span>Members</span></div>
        <div class="section-sub">${MEMBERS.length} members ¬∑ ${MEMBERS.filter(m=>m.online).length} online</div>
      </div>
    </div>
    <div class="profiles-grid">
      ${MEMBERS.map(m => `
        <div class="profile-card">
          <div class="profile-av" style="background:${m.color}">${m.initials}</div>
          ${m.online ? '<div class="online-badge"><div class="online-dot"></div> Online</div>' : '<div style="font-size:10px;color:var(--text-muted);margin-bottom:10px;">Offline</div>'}
          <div class="profile-name">${m.name}</div>
          <div class="profile-role">${m.role}</div>
          <div style="font-family:var(--font-mono);font-size:10px;color:var(--text-muted);margin-bottom:14px;">${m.tag}</div>
          <div class="profile-stats">
            <div class="ps"><div class="ps-val">${m.events}</div><div class="ps-label">Events</div></div>
            <div class="ps"><div class="ps-val">${m.rsvps}</div><div class="ps-label">RSVPs</div></div>
          </div>
        </div>
      `).join('')}
    </div>
  `;
}

// ‚îÄ‚îÄ DISCORD PAGE ‚îÄ‚îÄ
function renderDiscord() {
  const commands = [
    { name:'/nightlog events', desc:'List all upcoming events in a Discord embed' },
    { name:'/nightlog create', desc:'Create a new event from Discord' },
    { name:'/nightlog rsvp [id]', desc:'RSVP to an event by ID' },
    { name:'/nightlog unrsvp [id]', desc:'Remove your RSVP from an event' },
    { name:'/nightlog who [id]', desc:'See who is going to an event' },
    { name:'/nightlog today', desc:'Show all events happening today' },
    { name:'/nightlog sync', desc:'Force sync between Discord and website' },
  ];
  return `
    <div class="section-header">
      <div>
        <div class="section-title">Discord <span>Integration</span></div>
        <div class="section-sub">Bot sync, commands & webhook config</div>
      </div>
    </div>
    <div class="discord-panel">
      <div class="discord-card">
        <div class="sync-status">
          <div class="sync-icon">ü§ñ</div>
          <div class="sync-info">
            <div class="sync-title">NIGHTLOG Bot ‚Äî Connected & Syncing</div>
            <div class="sync-sub">Server: Your Gaming Community ¬∑ Members: 47 ¬∑ Last sync: just now</div>
          </div>
          <button class="btn btn-sm btn-cyan" onclick="showToast('Sync triggered!', 'success')">‚ü≥ Sync Now</button>
        </div>

        <div class="sidebar-title" style="margin-bottom:14px;">‚ö° Bot Commands</div>
        <div class="command-list">
          ${commands.map(c => `
            <div class="command-item">
              <div class="command-name">${c.name}</div>
              <div class="command-desc">${c.desc}</div>
            </div>
          `).join('')}
        </div>
      </div>

      <div class="discord-card">
        <div class="sidebar-title" style="margin-bottom:14px;">üîó Webhook Config</div>
        <p style="font-size:13px;color:var(--text-secondary);margin-bottom:16px;line-height:1.7;">
          Paste your Discord channel webhook URL below to receive automatic event notifications whenever an event is created, updated, or an RSVP threshold is hit.
        </p>
        <div class="form-group">
          <label class="form-label">Webhook URL</label>
          <div class="webhook-config">
            <input class="form-input webhook-input" placeholder="https://discord.com/api/webhooks/..." id="webhook-url" />
            <button class="btn btn-primary" onclick="saveWebhook()">Save</button>
          </div>
        </div>
        <div class="form-group">
          <label class="form-label">Notification Triggers</label>
          <div style="display:flex;flex-direction:column;gap:10px;margin-top:6px;">
            ${[['new_event','New event created'],['rsvp_milestone','RSVP milestone reached (5, 10, 15...)'],['event_reminder','24h event reminder'],['event_cancelled','Event cancelled']].map(([k,l])=>`
              <label style="display:flex;align-items:center;gap:10px;cursor:pointer;font-size:13px;color:var(--text-secondary);">
                <input type="checkbox" checked style="accent-color:var(--indigo);width:14px;height:14px;" /> ${l}
              </label>
            `).join('')}
          </div>
        </div>
        <button class="btn btn-ghost btn-sm" onclick="showToast('Webhook settings saved!', 'success')">Save Preferences</button>
      </div>

      <div class="discord-card">
        <div class="sidebar-title" style="margin-bottom:14px;">üìä Sync Stats</div>
        <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:16px;">
          ${[['Events Synced','6','üóì'],['RSVPs via Bot','28','‚úì'],['Webhooks Sent','14','üì°']].map(([l,v,i])=>`
            <div style="text-align:center;padding:16px;background:rgba(10,11,18,0.6);border:1px solid var(--border);border-radius:6px;">
              <div style="font-size:22px;margin-bottom:4px;">${i}</div>
              <div style="font-family:var(--font-display);font-size:22px;color:var(--indigo-bright);">${v}</div>
              <div style="font-size:11px;color:var(--text-muted);letter-spacing:1px;margin-top:2px;">${l}</div>
            </div>
          `).join('')}
        </div>
      </div>
    </div>
  `;
}

// ‚îÄ‚îÄ EVENT DETAIL MODAL ‚îÄ‚îÄ
function renderEventModal() {
  if (!selectedEvent) return '';
  const e = selectedEvent;
  const tm = TYPE_META[e.type];
  const isGoing = userRSVPs.has(e.id);
  return `
    <div class="modal-overlay" onclick="closeModal(event)">
      <div class="modal" onclick="event.stopPropagation()">
        <div class="modal-header">
          <div>
            <span class="event-type-badge ${tm.cls}">${tm.emoji} ${tm.label}</span>
            <div class="modal-title">${e.title}</div>
          </div>
          <button class="modal-close" onclick="closeEventModal()">‚úï</button>
        </div>
        <div class="modal-body">
          <p style="font-size:14px;color:var(--text-secondary);line-height:1.7;margin-bottom:20px;">${e.desc}</p>
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:20px;">
            ${[['üìÖ Date', e.date],['‚è∞ Time', e.time],['‚è± Duration', e.duration],['üë§ Host', e.host]].map(([l,v])=>`
              <div style="background:rgba(10,11,18,0.6);border:1px solid var(--border);border-radius:6px;padding:12px 14px;">
                <div style="font-size:11px;color:var(--text-muted);letter-spacing:1px;margin-bottom:4px;">${l}</div>
                <div style="font-size:14px;font-weight:600;font-family:var(--font-mono);">${v}</div>
              </div>
            `).join('')}
          </div>
          <div style="margin-bottom:20px;">
            <div style="font-size:11px;color:var(--text-muted);letter-spacing:1.5px;text-transform:uppercase;margin-bottom:10px;">
              Who's Going (${e.rsvps.length}${e.maxSlots ? '/'+e.maxSlots : ''})
            </div>
            <div style="display:flex;flex-wrap:wrap;gap:8px;">
              ${e.rsvps.map(r=>`
                <div style="display:flex;align-items:center;gap:6px;padding:4px 10px;background:rgba(99,102,241,0.08);border:1px solid var(--border);border-radius:20px;font-size:12px;">
                  <div style="width:20px;height:20px;border-radius:50%;background:linear-gradient(135deg,var(--indigo),var(--violet));display:flex;align-items:center;justify-content:center;font-size:9px;font-weight:700;">${r.slice(0,2).toUpperCase()}</div>
                  ${r}
                </div>
              `).join('')}
            </div>
          </div>
          <div style="display:flex;gap:10px;">
            <button class="btn ${isGoing ? 'btn-danger' : 'btn-primary'}" onclick="toggleRSVP(${e.id}, event);rerenderModal()">
              ${isGoing ? '‚úï Cancel RSVP' : '‚úì RSVP ‚Äî I\'m Going'}
            </button>
            ${e.discord ? `<button class="btn btn-cyan btn-sm" onclick="showToast('Posting to Discord...', 'info')">üì° Post to Discord</button>` : ''}
          </div>
        </div>
      </div>
    </div>
  `;
}

// ‚îÄ‚îÄ CREATE EVENT MODAL ‚îÄ‚îÄ
let createModalOpen = false;
let newEvent = { title:'', type:'gaming', date:'', time:'18:00', duration:'2h', desc:'' };

function renderCreateModal() {
  if (!createModalOpen) return '';
  return `
    <div class="modal-overlay" onclick="closeCreate(event)">
      <div class="modal" onclick="event.stopPropagation()">
        <div class="modal-header">
          <div class="modal-title">Create <span style="color:var(--indigo-bright)">Event</span></div>
          <button class="modal-close" onclick="closeCreateModal()">‚úï</button>
        </div>
        <div class="modal-body">
          <div class="form-group">
            <label class="form-label">Event Type</label>
            <div class="type-selector">
              ${Object.entries(TYPE_META).map(([k,v])=>`
                <div class="type-option ${newEvent.type===k?'selected':''}" onclick="setEventType('${k}')">
                  <span class="type-emoji">${v.emoji}</span>${v.label}
                </div>
              `).join('')}
            </div>
          </div>
          <div class="form-group">
            <label class="form-label">Event Title</label>
            <input class="form-input" id="ne-title" placeholder="Give your event a name..." value="${newEvent.title}" oninput="newEvent.title=this.value" />
          </div>
          <div class="form-group">
            <label class="form-label">Description</label>
            <textarea class="form-input" id="ne-desc" placeholder="Tell the community what this event is about..." oninput="newEvent.desc=this.value">${newEvent.desc}</textarea>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label class="form-label">Date</label>
              <input type="date" class="form-input" id="ne-date" value="${newEvent.date}" oninput="newEvent.date=this.value" />
            </div>
            <div class="form-group">
              <label class="form-label">Time</label>
              <select class="form-input form-select" id="ne-time" onchange="newEvent.time=this.value">
                ${generateTimeOptions(newEvent.time)}
              </select>
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label class="form-label">Duration</label>
              <input class="form-input" id="ne-dur" placeholder="e.g. 2h, 30m" value="${newEvent.duration}" oninput="newEvent.duration=this.value" />
            </div>
            <div class="form-group">
              <label class="form-label">Max Slots (optional)</label>
              <input type="number" class="form-input" placeholder="Leave blank for unlimited" />
            </div>
          </div>
          <div class="form-group">
            <label style="display:flex;align-items:center;gap:10px;cursor:pointer;font-size:13px;color:var(--text-secondary);">
              <input type="checkbox" checked style="accent-color:var(--indigo);width:14px;height:14px;" />
              Sync to Discord automatically
            </label>
          </div>
          <div style="display:flex;gap:10px;">
            <button class="btn btn-primary" onclick="submitCreateEvent()">‚úì Create Event</button>
            <button class="btn btn-ghost" onclick="closeCreateModal()">Cancel</button>
          </div>
        </div>
      </div>
    </div>
  `;
}

// ‚îÄ‚îÄ HANDLERS ‚îÄ‚îÄ
function attachHandlers() {
  // handlers are inline onclick - no extra binding needed
}

function changeMonth(dir) {
  calMonth += dir;
  if (calMonth < 0) { calMonth = 11; calYear--; }
  if (calMonth > 11) { calMonth = 0; calYear++; }
  render();
}

function openEvent(id, e) {
  if (e) e.stopPropagation();
  selectedEvent = EVENTS.find(ev => ev.id === id);
  createModalOpen = false;
  render();
}

function closeEventModal() { selectedEvent = null; render(); }

function closeModal(e) {
  if (e.target.classList.contains('modal-overlay')) {
    selectedEvent = null;
    createModalOpen = false;
    render();
  }
}

function closeCreate(e) {
  if (e.target.classList.contains('modal-overlay')) {
    createModalOpen = false;
    render();
  }
}

function openCreateModal() {
  selectedEvent = null;
  createModalOpen = true;
  render();
}

function closeCreateModal() {
  createModalOpen = false;
  render();
}

function setEventType(t) {
  newEvent.type = t;
  render();
}

function toggleRSVP(id, e) {
  if (e) e.stopPropagation();
  const event = EVENTS.find(ev => ev.id === id);
  if (userRSVPs.has(id)) {
    userRSVPs.delete(id);
    event.rsvps = event.rsvps.filter(r => r !== 'You');
    showToast(`Removed RSVP for "${event.title}"`, 'info');
  } else {
    userRSVPs.add(id);
    if (!event.rsvps.includes('You')) event.rsvps.push('You');
    showToast(`RSVP confirmed for "${event.title}" ‚Äî syncing to Discord...`, 'success');
  }
  render();
  if (selectedEvent && selectedEvent.id === id) {
    selectedEvent = EVENTS.find(ev => ev.id === id);
    render();
  }
}

function rerenderModal() {
  render();
}

async function submitCreateEvent() {
  if (!currentUser?.isAdmin) { showToast('Only admins can create events', 'info'); return; }
  if (!newEvent.title.trim()) { showToast('Please enter an event title', 'info'); return; }
  if (!newEvent.date) { showToast('Please pick a date', 'info'); return; }
  
  const success = await createEvent(newEvent);
  if (success) {
    newEvent = { title:'', type:'gaming', date:'', time:'7:00 PM', duration:'2h', desc:'' };
    createModalOpen = false;
    render();
  }
}

function saveWebhook() {
  const url = document.getElementById('webhook-url')?.value;
  if (!url) { showToast('Please enter a webhook URL', 'info'); return; }
  showToast('Webhook saved & connected!', 'success');
}

// ‚îÄ‚îÄ TOAST ‚îÄ‚îÄ
function showToast(msg, type = 'info') {
  const container = document.getElementById('toast-container');
  const toast = document.createElement('div');
  toast.className = `toast ${type}`;
  toast.innerHTML = `<span class="toast-icon">${type === 'success' ? '‚úì' : '‚Ñπ'}</span><span>${msg}</span>`;
  container.appendChild(toast);
  setTimeout(() => toast.remove(), 3500);
}

// ‚îÄ‚îÄ INIT ‚îÄ‚îÄ
// Data loads automatically via loadData() above

</script>
</body>
</html>
